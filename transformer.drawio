<mxfile host="65bd71144e">
    <diagram id="biJ7z7tTQsiZoMqXXx1a" name="Page-1">
        <mxGraphModel dx="703" dy="2850" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="311" value="" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="150" y="-1080" width="560" height="920" as="geometry"/>
                </mxCell>
                <mxCell id="290" value="" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="790" y="-1200" width="800" height="570" as="geometry"/>
                </mxCell>
                <mxCell id="288" value="" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="2142" y="-1240" width="1505" height="1470" as="geometry"/>
                </mxCell>
                <mxCell id="287" value="" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="910" y="-940" width="330" height="230" as="geometry"/>
                </mxCell>
                <mxCell id="188" value="" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="3980" y="-1120" width="860" height="790" as="geometry"/>
                </mxCell>
                <mxCell id="148" value="" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="790" y="-470" width="1040" height="620" as="geometry"/>
                </mxCell>
                <mxCell id="145" value="" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="2460" y="-2020" width="330" height="570" as="geometry"/>
                </mxCell>
                <mxCell id="132" value="" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="875" y="-200" width="430" height="330" as="geometry"/>
                </mxCell>
                <mxCell id="90" value="" style="rounded=1;whiteSpace=wrap;html=1;sketch=1;curveFitting=1;jiggle=2;shadow=0;" vertex="1" parent="1">
                    <mxGeometry x="2420" y="530" width="720" height="790" as="geometry"/>
                </mxCell>
                <mxCell id="5" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="3" target="4">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="7" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="3">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1069.9999999999995" y="-1030" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="3" value="src_seq&lt;br&gt;(batch x seq)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1010" y="-1150" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="282" style="edgeStyle=none;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="4" target="196">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1400" y="-1050" as="targetPoint"/>
                        <Array as="points">
                            <mxPoint x="1400" y="-880"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="4" value="src_mask&lt;br&gt;(batch x 1 x seq)&lt;br&gt;torch.bool" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1340" y="-1150" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="84" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="74" target="76">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="74" value="Linear1&lt;br&gt;（d_model x d_inner)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2700" y="690" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="86" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="75" target="77">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="75" value="Linear2&lt;br&gt;(d_inner x d_model)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2700" y="900" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="85" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="76" target="75">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="76" value="relu" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2700" y="800" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="87" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="77" target="81">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="77" value="dropout" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2700" y="1010" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="83" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="79" target="74">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="89" style="edgeStyle=none;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="79" target="81">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="2550" y="570"/>
                            <mxPoint x="2550" y="1150"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="79" value="注意力层输出&lt;br&gt;(batch x seq x d_model)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2700" y="540" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="88" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="81" target="82">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="81" value="残差&lt;br&gt;(batch x seq x d_model)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2700" y="1120" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="82" value="layer_norm" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2700" y="1230" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="94" value="全连接" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="2440" y="600" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="104" value="编码层 x 6" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="920" y="-930" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="106" value="编码器" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="820" y="-1180" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="109" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="107" target="108">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="115" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="107" target="110">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="107" value="trg_seq&lt;br&gt;(batch x seq)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1030" y="-450" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="123" style="edgeStyle=none;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="108" target="121">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="1290" y="-150"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="108" value="trg_mask&lt;br&gt;(隐藏未来信息)&lt;br&gt;(batch x seq x seq)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1230" y="-450" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="147" value="" style="edgeStyle=none;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="110" target="121">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="110" value="embdding层&lt;br&gt;(batch x seq x d_word_vec)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1000" y="-330" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="125" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="121" target="124">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="121" value="带掩码的自注意力层&lt;br&gt;(batch x seq x d_model)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1000" y="-180" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="131" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="124" target="130">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="124" value="编码器，解码器注意力层&lt;br&gt;(batch x seq x d_model)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="998" y="-80" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="128" style="edgeStyle=none;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="126" target="124">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="1189.9999999999995" y="340" as="targetPoint"/>
                        <Array as="points">
                            <mxPoint x="1500" y="-50"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="126" value="enc_output&lt;br&gt;(batch x seq x d_model)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1430" y="-450" width="140" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="129" style="edgeStyle=none;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="127" target="124">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="1720" y="-50"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="127" value="src_mask&lt;br&gt;(batch x 1 x seq)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="1660" y="-450" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="130" value="全连接&lt;br&gt;(batch x seq x d_model)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="998" y="20" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="133" value="解码层 x 6" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="885" y="-180" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="135" value="解码器" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="829" y="-450" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="136" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="137" target="139">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="137" value="trg_word_emb&lt;br&gt;(batch x seq x d_word_vec)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2550" y="-1990" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="138" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="139" target="141">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="139" value="嵌入缩放&lt;br&gt;[* d_model ** 0.5]&lt;br&gt;与最后的线性投影互斥" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2550" y="-1860" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="140" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="141" target="143">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="141" value="位置编码" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2550" y="-1740" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="142" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="143" target="144">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="143" value="dropout" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2550" y="-1650" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="144" value="layer_norm" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2550" y="-1550" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="146" value="embdding层" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="2470" y="-1990" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="163" style="edgeStyle=none;html=1;" edge="1" parent="1" source="164" target="170">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="164" value="升维&lt;br&gt;(batch x 1 x 1 x seq)&lt;br&gt;torch.bool" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="4620" y="-770" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="165" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="166" target="168">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="166" value="matmul&lt;br&gt;(batch x n_head x seq x seq)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="4210" y="-980" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="167" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="168" target="170">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="168" value="嵌入缩放&lt;br&gt;[/ d_k ** 0.5]" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="4210" y="-890" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="169" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="170" target="172">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="170" value="mask&lt;br&gt;计算有效的注意力分" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="4240" y="-770" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="171" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="172" target="174">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="172" value="softmax&lt;br&gt;[dim=-1]" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="4240" y="-670" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="173" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="174" target="175">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="174" value="dropout(最终的注意力分数）&lt;br&gt;(batch x n_head x seq x seq)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="4210" y="-570" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="175" value="matmul&lt;br&gt;(batch x n_head x seq x d_v)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="4210" y="-450" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="176" value="缩放点积注意力" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="4030" y="-1060" width="90" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="178" style="edgeStyle=none;html=1;" edge="1" parent="1" source="177" target="164">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="177" value="src_mask&lt;br&gt;(batch x 1 x seq)&lt;br&gt;torch.bool" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="4620" y="-1100" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="185" style="edgeStyle=none;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="179" target="166">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="179" value="q&lt;br&gt;(batch x n_head x seq&amp;nbsp; x d_k" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="4170" y="-1100" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="186" style="edgeStyle=none;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="182" target="166">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="182" value="k&lt;br&gt;(batch x n_head x d_k x seq" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="4320" y="-1100" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="184" style="edgeStyle=none;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="183" target="175">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="4530" y="-420"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="183" value="v&lt;br&gt;(batch x n_head x seq x d_v" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="4470" y="-1100" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="190" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" target="193">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="200" y="1590" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="192" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" target="195">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="200" y="1700" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="286" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="196" target="285">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="196" value="多头注意力/&lt;br&gt;自注意力层&lt;br&gt;(batch x seq x d_model)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="980" y="-910" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="197" style="edgeStyle=none;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="201" target="203">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="198" style="edgeStyle=none;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="201" target="207">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="199" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="201" target="205">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="200" style="edgeStyle=none;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="201" target="236">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2457" y="-490" as="targetPoint"/>
                        <Array as="points">
                            <mxPoint x="2457" y="-1160"/>
                            <mxPoint x="2457" y="90"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="201" value="embdding序列&lt;br&gt;(batch x seq x d_word_vec)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2707" y="-1190" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="202" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="203" target="209">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="203" value="Linear&lt;br&gt;(d_model x n_head * d_k)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2497" y="-1080" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="204" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="205" target="211">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="205" value="Linear&lt;br&gt;(d_model x n_head * d_k)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2707" y="-1080" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="206" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="207" target="213">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="207" value="Linear&lt;br&gt;（d_model x n_head * d_v)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2917" y="-1080" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="208" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="209" target="215">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="209" value="q&lt;br&gt;(batch x seq x n_head * d_k)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2497" y="-980" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="210" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="211" target="217">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="211" value="k&lt;br&gt;(batch x seq x n_head * d_k)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2707" y="-980" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="212" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="213" target="219">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="213" value="v&lt;br&gt;(batch x seq x n_head * d_v)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2917" y="-980" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="214" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="215" target="221">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="215" value="view&lt;br&gt;(batch x seq x n_head x d_k)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2497" y="-890" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="216" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="217" target="223">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="217" value="view&lt;br&gt;(batch x seq x n_head x d_k)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2707" y="-890" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="218" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="219" target="225">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="219" value="view&lt;br&gt;(batch x seq x n_head x d_k)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2917" y="-890" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="220" style="edgeStyle=none;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="221" target="226">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="221" value="transpose&lt;br&gt;(batch x n_head&amp;nbsp;x seq x d_k)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2497" y="-800" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="222" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="223" target="228">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="223" value="transpose&lt;br&gt;(batch x n_head&amp;nbsp;x seq x d_k)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2707" y="-800" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="224" style="edgeStyle=none;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="225" target="226">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2787" as="targetPoint"/>
                        <Array as="points">
                            <mxPoint x="3007" y="-380"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="225" value="transpose&lt;br&gt;(batch x n_head&amp;nbsp;x seq x d_k)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2917" y="-800" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="226" value="缩放点积注意力&lt;br&gt;(batch x n_head x seq x d_v)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2647" y="-410" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="227" style="edgeStyle=none;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="1" source="228" target="226">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="228" value="transpose&lt;br&gt;(batch x n_head&amp;nbsp;x d_k x seq)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2707" y="-640" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="229" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" target="231">
                    <mxGeometry relative="1" as="geometry">
                        <mxPoint x="2737" y="-350" as="sourcePoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="230" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="231" target="233">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="231" value="转置/contiguous/view&lt;br&gt;(batch x seq&amp;nbsp;x n_head * d_v)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2647" y="-280" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="232" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="233" target="235">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="233" value="Linear&lt;br&gt;(n_head * d_v x d_model)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2647" y="-170" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="234" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="235" target="236">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="235" value="dropout&lt;br&gt;(batch x seq x d_model)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2647" y="-60" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="278" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="236" target="277">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="236" value="残差&lt;br&gt;(batch x seq x d_model)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2647" y="60" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="277" value="layer_norm" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="2647" y="150" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="280" style="edgeStyle=none;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="279" target="226">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="3287" y="-380"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="279" value="src_mask&lt;br&gt;(batch x 1 x seq)&lt;br&gt;torch.bool" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="3227" y="-1190" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="284" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="283" target="196">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="283" value="embdding层&lt;br&gt;(batch x seq x d_word_vec)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="980" y="-1030" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="285" value="全连接层&lt;br&gt;(batch x seq x d_model)" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
                    <mxGeometry x="980" y="-810" width="180" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="289" value="多头注意力/&lt;br&gt;自注意力层" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="2227" y="-1175" width="70" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="298" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="292" target="293">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="292" value="编码器" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="370" y="-710" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="299" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="293" target="294">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="293" value="解码器" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="370" y="-610" width="120" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="300" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="294" target="295">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="294" value="线性投影&lt;br&gt;Linear&lt;br&gt;（可)与解码器的emb共享权重" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="345" y="-500" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="301" value="" style="edgeStyle=none;html=1;" edge="1" parent="1" source="295" target="297">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="295" value="投影权重缩放&lt;br&gt;[* d_model ** 0.5]&lt;br&gt;与嵌入缩放互斥（很好理解吧" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="345" y="-400" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="297" value="输出&lt;br&gt;(batch * seq x n_trg_vocab)" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="345" y="-280" width="170" height="60" as="geometry"/>
                </mxCell>
                <mxCell id="303" value="Transformer" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="180" y="-1060" width="60" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="304" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;strokeWidth=3;shadow=1;sketch=1;curveFitting=1;jiggle=2;dashed=1;" edge="1" parent="1" source="292">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="629.9999999999995" y="-678.8198757763976" as="sourcePoint"/>
                        <mxPoint x="820" y="-870" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="310" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=-0.002;entryY=0.407;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;strokeWidth=3;shadow=1;sketch=1;curveFitting=1;jiggle=2;" edge="1" parent="1" source="293" target="148">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="690" y="-520" as="sourcePoint"/>
                        <mxPoint x="740" y="-570" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="312" value="" style="endArrow=classic;html=1;shadow=1;dashed=1;sketch=1;strokeWidth=3;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=-0.01;entryY=0.466;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="226" target="188">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="3470" y="-630" as="sourcePoint"/>
                        <mxPoint x="3520" y="-680" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="313" value="" style="endArrow=classic;html=1;shadow=1;dashed=1;sketch=1;strokeWidth=3;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="283">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="2030" y="-920" as="sourcePoint"/>
                        <mxPoint x="2450" y="-1750" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="314" value="" style="endArrow=classic;html=1;shadow=1;dashed=1;sketch=1;strokeWidth=3;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontStyle=1" edge="1" parent="1" source="196" target="288">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="2030" y="-630" as="sourcePoint"/>
                        <mxPoint x="2080" y="-680" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="315" value="" style="endArrow=classic;html=1;shadow=1;dashed=1;sketch=1;strokeWidth=3;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="285" target="90">
                    <mxGeometry width="50" height="50" relative="1" as="geometry">
                        <mxPoint x="2030" y="-350" as="sourcePoint"/>
                        <mxPoint x="2080" y="-400" as="targetPoint"/>
                    </mxGeometry>
                </mxCell>
                <mxCell id="316" value="源词大小" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="230" y="-1020" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="317" value="目标词大小" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="340" y="-1020" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="318" value="源词padding索引" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="230" y="-960" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="319" value="目标词padding索引" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="340" y="-960" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="320" value="词embedding维度" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="450" y="-1020" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="321" value="模型维度" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="450" y="-960" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="322" value="线性层维度" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="550" y="-1020" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="333" value="编解码层个数" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="550" y="-960" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="334" value="头大小" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="230" y="-890" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="336" value="v维度" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="440" y="-890" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="337" value="dropout值" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="230" y="-830" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="338" value="位置长度" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="560" y="-890" width="80" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="339" value="源词embedding和目标词embeeding权重是否共享" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="345" y="-830" width="100" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="340" value="最后线性投影是否与目标词embedding权重共享" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="470" y="-837.5" width="100" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="341" value="是否进行embedding缩放或者最后线性投影值缩放" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="600" y="-830" width="100" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="342" value="k维度" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;sketch=1;" vertex="1" parent="1">
                    <mxGeometry x="340" y="-890" width="80" height="40" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>